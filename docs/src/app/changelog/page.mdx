export const metadata = { title: "Changelog" }

# Changelog

## V0.4.0 (FEBRUARY 2026)

Security hardening, untrusted-data tagging, and engine unification.

- Added `_data_origin: untrusted_spreadsheet` field to all structured JSON responses — provides per-call provenance context for agent consumers across `read`, `search`, `probe`, `overview`, `inspect`, `format --read`, `export --format json`, and `vba`
- Added `--json-envelope` flag to `export` — wraps CSV and Markdown stdout in a JSON envelope with `_data_origin` for agent pipelines that need provenance on all output formats
- Added automatic VBA security pre-check before every macro execution — macros with `risk_level=high` are blocked and raise `MacroBlockedError`; use `--allow-risky` to override when the file source is explicitly trusted
- Added extension gate to `vba --run` — macro execution now requires `.xlsm` or `.xlsb`; plain `.xlsx` files are rejected with a structured error
- Added macro name validation to `vba --run` — rejects names containing path separators or shell meta-characters
- Added XXE protection — `defusedxml.defuse_stdlib()` is activated at import time, hardening all stdlib XML parsers used by openpyxl and oletools against entity expansion and DTD retrieval attacks
- Fixed chart export filename sanitisation — strips path separators and `..` sequences to prevent path traversal via crafted chart names
- Fixed `copy_formatting()` missing the writable-extension guard (now consistent with `write_cells()` and `apply_formatting()`)
- Fixed `ASPOSE_LICENSE_DATA` warning — now emitted on env-var *presence*, even when `ASPOSE_LICENSE_PATH` takes precedence, since the env var remains visible in process listings
- Unified engine auto-detection order across `objects`, `recalc`, and `screenshot` — priority is now consistently Aspose → Excel → LibreOffice via a shared `resolve_engine` utility
- Added 26 security regression tests covering data-origin tagging, VBA gates, and credential warning behaviour
- Added lint-and-test CI gate before PyPI publish; pinned all GitHub Actions to immutable commit SHAs

## V0.3.0 (FEBRUARY 2026)

Date handling overhaul, docs site, and reliability fixes.

- Added documentation site with full command reference, backend guide, and changelog
- Overhauled date handling — index-based detection now works correctly in `--no-header` mode across `read`, `search`, `export`, and `probe`. Midnight datetimes normalised to date-only strings
- Added `INVALID_REGEX` structured error for malformed regex patterns in `search --regex` (including Rust regex engine incompatibilities)
- Further optimised print area handling in LibreOffice `_prepare_sheet_for_export` for better PDF export
- Added save-path guard in `format` and `sheet` commands — non-writable extensions now fall back to `.xlsx` instead of silently saving OOXML content with the original extension
- Updated skill and command reference docs for output format clarity (`--format csv|markdown`), `--in-formulas` output schema, and engine availability per command

## V0.2.0 (FEBRUARY 2026)

Non-tabular data support, multi-range reads, and compact output.

- Added `--no-header` flag to `probe`, `read`, `search`, and `export` for non-tabular sheets (P&L reports, dashboards). Treats row 1 as data and uses column letters (A, B, C) as headers
- Added `--compact/--no-compact` mode to `read` and `export` (default: on). Drops fully-null columns to reduce token waste
- Added `--all-sheets` flag to `read` for reading the same range(s) from every sheet
- Added multi-range read support — comma-separated ranges like `"Sheet1!A1:C10,E1:G10"`
- Added `--range` / `-r` option flag to `screenshot` (alternative to positional RANGE arg)
- Added `--vba` and `--format` / `-f` flags to `inspect`
- Changed auto-detection priority — Aspose is now checked first for `screenshot` and `recalc` (was Excel first)
- Added shell-escaped cell reference normalisation for zsh compatibility (`\!` in ranges)
- Fixed xlwings screenshot transparency — PNGs are now opaque (flattened onto white background)
- Enhanced LibreOffice multi-page PDF rendering and print area optimisation
- Improved formula detection in compact mode
- Added `aspose-cells-python` as a direct dependency

## V0.1.1 (FEBRUARY 2026)

CLI polish release.

- Added `-h` / `--help` flag support across all commands
- Added `--version` / `-V` flag to display the installed version
- Removed shell completion clutter from help output
- Fixed `-o` flag conflict on `read --offset`
- Fixed double period in help text descriptions

## V0.1.0 (FEBRUARY 2026)

Initial release.

- **14 commands:** `probe`, `overview`, `inspect`, `read`, `search`, `write`, `sheet`, `format`, `export`, `screenshot`, `objects`, `recalc`, `vba`, `license`
- **5 adapters:** Polars + fastexcel for data reads, openpyxl for metadata and writes, xlwings for Excel rendering, Aspose.Cells for cross-platform rendering, LibreOffice for free rendering
- **Polars + fastexcel** for fast data reads (7-10x faster than openpyxl)
- **openpyxl** for metadata inspection and write operations
- **xlwings / Aspose / LibreOffice** for screenshots, objects, and recalculation
- **oletools** for VBA macro inspection and extraction
- **Structured JSON output** to stdout, optimised for AI context windows
- **Auto date detection** — converts Excel serial numbers to ISO 8601 strings
- **5 formats** — `.xlsx`, `.xlsm`, `.xlsb`, `.xls`, `.ods`
- **Agent Skill support** — works with Claude Code, Cursor, and other AI agents via skill files
